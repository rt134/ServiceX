{"version":3,"file":"index.js","sources":["../src/chart.tsx","../src/index.tsx"],"sourcesContent":["import React, {\n  useEffect,\n  useState,\n  useRef,\n  useImperativeHandle,\n  useMemo,\n  forwardRef,\n} from 'react';\n// eslint-disable-next-line no-unused-vars\nimport { Props } from './types';\n\nimport Chart from 'chart.js/auto';\n\nimport merge from 'lodash/merge';\nimport assign from 'lodash/assign';\nimport find from 'lodash/find';\n\nconst ChartComponent = forwardRef<Chart | undefined, Props>((props, ref) => {\n  const {\n    id,\n    className,\n    height = 150,\n    width = 300,\n    redraw = false,\n    type,\n    data,\n    options = {},\n    plugins = [],\n  } = props;\n\n  const canvas = useRef<HTMLCanvasElement>(null);\n\n  const computedData = useMemo<Chart.ChartData>(() => {\n    if (typeof data === 'function') {\n      return canvas.current ? data(canvas.current) : {};\n    } else return merge({}, data);\n  }, [data, canvas.current]);\n\n  const [chart, setChart] = useState<Chart>();\n\n  useImperativeHandle<Chart | undefined, Chart | undefined>(ref, () => chart, [\n    chart,\n  ]);\n\n  const renderChart = () => {\n    if (!canvas.current) return;\n\n    setChart(\n      new Chart(canvas.current, {\n        type,\n        data: computedData,\n        options,\n        plugins,\n      })\n    );\n  };\n\n  const onClick = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!chart) return;\n\n    const { getDatasetAtEvent, getElementAtEvent, getElementsAtEvent } = props;\n\n    getDatasetAtEvent &&\n      getDatasetAtEvent(\n        chart.getElementsAtEventForMode(\n          e,\n          'dataset',\n          { intersect: true },\n          false\n        ),\n        e\n      );\n    getElementAtEvent &&\n      getElementAtEvent(\n        chart.getElementsAtEventForMode(\n          e,\n          'nearest',\n          { intersect: true },\n          false\n        ),\n        e\n      );\n    getElementsAtEvent &&\n      getElementsAtEvent(\n        chart.getElementsAtEventForMode(e, 'index', { intersect: true }, false),\n        e\n      );\n  };\n\n  const updateChart = () => {\n    if (!chart) return;\n\n    if (options) {\n      chart.options = { ...options };\n    }\n\n    if (!chart.config.data) {\n      chart.config.data = computedData;\n      chart.update();\n      return;\n    }\n\n    const { datasets: newDataSets = [], ...newChartData } = computedData;\n    const { datasets: currentDataSets = [] } = chart.config.data;\n\n    // copy values\n    assign(chart.config.data, newChartData);\n    chart.config.data.datasets = newDataSets.map((newDataSet: any) => {\n      // given the new set, find it's current match\n      const currentDataSet = find(\n        currentDataSets,\n        d => d.label === newDataSet.label && d.type === newDataSet.type\n      );\n\n      // There is no original to update, so simply add new one\n      if (!currentDataSet || !newDataSet.data) return newDataSet;\n\n      if (!currentDataSet.data) {\n        currentDataSet.data = [];\n      } else {\n        currentDataSet.data.length = newDataSet.data.length;\n      }\n\n      // copy in values\n      assign(currentDataSet.data, newDataSet.data);\n\n      // apply dataset changes, but keep copied data\n      return {\n        ...currentDataSet,\n        ...newDataSet,\n        data: currentDataSet.data,\n      };\n    });\n\n    chart.update();\n  };\n\n  const destroyChart = () => {\n    if (chart) chart.destroy();\n  };\n\n  useEffect(() => {\n    renderChart();\n\n    return () => destroyChart();\n  }, []);\n\n  useEffect(() => {\n    if (redraw) {\n      destroyChart();\n      setTimeout(() => {\n        renderChart();\n      }, 0);\n    } else {\n      updateChart();\n    }\n  }, [props, computedData]);\n\n  return (\n    <canvas\n      height={height}\n      width={width}\n      ref={canvas}\n      id={id}\n      className={className}\n      onClick={onClick}\n      data-testid='canvas'\n    />\n  );\n});\n\nexport default ChartComponent;\n","import React, { forwardRef } from 'react';\n// eslint-disable-next-line no-unused-vars\nimport { Props } from './types';\nimport ChartComponent from './chart';\n// eslint-disable-next-line no-unused-vars\nimport Chart from 'chart.js/auto';\nimport * as chartjs from 'chart.js';\n\nexport const Line = forwardRef<Chart | undefined, Props>((props, ref) => (\n  <ChartComponent\n    {...props}\n    type='line'\n    ref={ref}\n    options={props.options || {}}\n  />\n));\n\nexport const Bar = forwardRef<Chart | undefined, Props>((props, ref) => (\n  <ChartComponent\n    {...props}\n    type='bar'\n    ref={ref}\n    options={props.options || {}}\n  />\n));\n\nexport const Radar = forwardRef<Chart | undefined, Props>((props, ref) => (\n  <ChartComponent\n    {...props}\n    type='radar'\n    ref={ref}\n    options={props.options || {}}\n  />\n));\n\nexport const Doughnut = forwardRef<Chart | undefined, Props>((props, ref) => (\n  <ChartComponent\n    {...props}\n    type='doughnut'\n    ref={ref}\n    options={props.options || {}}\n  />\n));\n\nexport const PolarArea = forwardRef<Chart | undefined, Props>((props, ref) => (\n  <ChartComponent\n    {...props}\n    type='polarArea'\n    ref={ref}\n    options={props.options || {}}\n  />\n));\n\nexport const Bubble = forwardRef<Chart | undefined, Props>((props, ref) => (\n  <ChartComponent\n    {...props}\n    type='bubble'\n    ref={ref}\n    options={props.options || {}}\n  />\n));\n\nexport const Pie = forwardRef<Chart | undefined, Props>((props, ref) => (\n  <ChartComponent\n    {...props}\n    type='pie'\n    ref={ref}\n    options={props.options || {}}\n  />\n));\n\nexport const Scatter = forwardRef<Chart | undefined, Props>((props, ref) => (\n  <ChartComponent\n    {...props}\n    type='scatter'\n    ref={ref}\n    options={props.options || {}}\n  />\n));\n\nexport const defaults = chartjs.defaults;\n\nexport const Chart = chartjs.Chart;\n\nexport default ChartComponent;\n"],"names":["ChartComponent","forwardRef","props","ref","id","className","height","width","redraw","type","data","options","plugins","canvas","useRef","computedData","useMemo","current","merge","useState","chart","setChart","useImperativeHandle","renderChart","Chart","onClick","e","getDatasetAtEvent","getElementAtEvent","getElementsAtEvent","getElementsAtEventForMode","intersect","updateChart","config","update","datasets","newDataSets","newChartData","currentDataSets","assign","map","newDataSet","currentDataSet","find","d","label","length","destroyChart","destroy","useEffect","setTimeout","React","Line","Bar","Radar","Doughnut","PolarArea","Bubble","Pie","Scatter","defaults","chartjs"],"mappings":"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"}